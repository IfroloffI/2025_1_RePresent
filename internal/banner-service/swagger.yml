TODO: Перенести логику из internal